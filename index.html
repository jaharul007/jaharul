<script>
    function togglePassword(fieldId) {
        const field = document.getElementById(fieldId);
        field.type = field.type === 'password' ? 'text' : 'password';
    }

    function showError(message) {
        const errorEl = document.getElementById('errorMessage');
        errorEl.textContent = message;
        errorEl.style.display = 'block';
        setTimeout(() => { errorEl.style.display = 'none'; }, 5000);
    }

    function showSuccess(message) {
        const successEl = document.getElementById('successMessage');
        successEl.textContent = message;
        successEl.style.display = 'block';
    }

    document.getElementById('loginForm').addEventListener('submit', async (e) => {
        e.preventDefault();

        const phoneNumber = document.getElementById('phoneNumber').value;
        const countryCode = document.getElementById('countryCode').value;
        const password = document.getElementById('password').value;

        if (phoneNumber.length < 10) {
            showError('Please enter a valid phone number');
            return;
        }

        document.getElementById('loading').style.display = 'block';
        document.getElementById('loginBtn').disabled = true;

        try {
            const response = await fetch('/api/login', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    phoneNumber: countryCode + phoneNumber,
                    password: password
                })
            });

            const data = await response.json();

            if (response.ok) {
                showSuccess('Login successful! Redirecting...');
                localStorage.setItem('user', JSON.stringify(data.user));
                setTimeout(() => {
                    window.location.href = 'homepage.html'; 
                }, 1500);
            } else {
                showError(data.error || 'Login failed. Please check your credentials.');
                document.getElementById('loginBtn').disabled = false;
            }
        } catch (error) {
            showError('Network error. Please check your connection.');
            document.getElementById('loginBtn').disabled = false;
        } finally {
            document.getElementById('loading').style.display = 'none';
        }
    });
</script>
